# åŸå‹é“¾
### ä¸€ã€åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼
1. é€šè¿‡å­—é¢é‡åˆ›å»º
```javascript
var obj1 = {name: 'obj1'};
obj1.__proto__ === Object.prototype // true
obj1.constructor === Object         // true
```
2. é€šè¿‡ new Object åˆ›å»º
```JavaScript
var obj2 = new Object({name: 'obj2'});
obj2.__proto__ === Object.prototype // true
obj2.constructor === Object         // true
```
3. é€šè¿‡å‡½æ•°åˆ›å»º
```javascript
var M = function(name) {
  this.name = name;
}
var obj3 = new M('obj3');
obj3.__proto__ === M.prototype   // true
obj3.constructor === M           // true
M.prototype.constructor === M    // true 
```
4. é€šè¿‡ Object.create åˆ›å»º
```javascript
var p = {name: 'p'};
var obj4 = Object.create(p);
obj4.__proto__ === p;   // true
obj4.name === 'p';      // true
```
---
### äºŒã€åŸå‹ã€æ„é€ å‡½æ•°ã€å®ä¾‹ã€åŸå‹é“¾
- æ„é€ å‡½æ•°ã€åŸå‹å¯¹è±¡ã€å®ä¾‹é—´çš„å…³ç³»å›¾    
![åŸå‹é“¾](imgs/åŸå‹é“¾.png)
ç”±ä¸Šå›¾å¯ä»¥å¾—çŸ¥ï¼š
  - æ„é€ å‡½æ•°.prototype.constructor === æ„é€ å‡½æ•°
  - æ„é€ å‡½æ•°.prototype === å®ä¾‹å¯¹è±¡.\_\_proto\_\_
---
### ä¸‰ã€ instanceof ä¸ typeof çš„åŒºåˆ«ä»¥åŠ instanceof çš„åŸç†
1. typeof åˆ¤æ–­æ•°æ®ç±»å‹
  - åŸºæœ¬æ•°æ®ç±»å‹(nullã€undefinedã€numberã€stringã€booleanï¼Œsymbol)é™¤äº†nullï¼Œéƒ½ä¼šè¿”å›æ­£ç¡®çš„æ•°æ®ç±»å‹ã€‚null ä¼šè¿”å› objectã€‚
  - å¯¹è±¡ç±»å‹ï¼Œå¯¹äºå‡½æ•°ä¼šè¿”å› functionï¼Œ å…¶ä»–çš„éƒ½è¿”å› object  
  - ï¼è¡¥å……ï¼šå¯ä»¥é€šè¿‡ $\color{#6CF}{Object.prototype.toString.call(xx)}$ æ¥åˆ¤æ–­å˜é‡çš„æ­£ç¡®ç±»å‹ï¼Œå®ƒä¼šè¿”å›ç±»ä¼¼ $\color{#6CF}{[object}$ $\color{#6CF}{Type]}$ çš„å­—ç¬¦ä¸²ã€‚

2. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ instanceof ?   
å¯ä»¥çœ‹å‡º typeof å¯¹äºå¯¹è±¡ç±»å‹çš„æ•°æ®ç±»å‹çš„åˆ¤æ–­å­˜åœ¨ç€å±€é™ï¼Œå› æ­¤è€ƒè™‘ä½¿ç”¨ instanceof æ¥è¿›è¡Œç±»å‹åˆ¤æ–­ã€‚

3. intanceof çš„å®ç°åŸç†
  - instanceof æ˜¯é€šè¿‡åŸå‹é“¾æ¥å®ç°ç»§æ‰¿å…³ç³»çš„åˆ¤æ–­ã€‚
  - ä» ECMA æ ‡å‡†ä¸­å¯ä»¥å¾—åˆ°ï¼šinstanceof å®é™…ä¸Šæ˜¯è°ƒç”¨äº† JS å†…éƒ¨å‡½æ•° $\color{#6CF}{[[HasInstance]]}$
  - å¯¹äº $\color{#6CF}{[[HasInstance]]}$ ï¼Œåœ¨ ES6 ä¸­ Symbolç« èŠ‚ä¸­æœ‰å¦‚ä¸‹è§£é‡Šï¼š
    - å¯¹è±¡çš„ $\color{#6CF}{Symbol.hasInstance}$ å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå†…éƒ¨çš„æ–¹æ³•ã€‚å½“å¯¹è±¡è°ƒç”¨ instanceof è¿ç®—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºè¯¥å¯¹è±¡çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚
    - æ¯”å¦‚ï¼Œ $\color{#6CF}{foo}$ $\color{#6CF}{instanceof}$ $\color{#6CF}{Foo}$ åœ¨è¯­è¨€å†…éƒ¨å®é™…ä¸Šæ˜¯è°ƒç”¨äº† $\color{#6CF}{Foo[Symbol.hasInstance](foo)}$ ã€‚
    - ä¸‹é¢æ˜¯ ECMA å¯¹äº $\color{#6CF}{[[HasInstance]]}$ çš„æè¿°ï¼š![HasInstance](imgs/HasInstance.png)

4. é€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œæ‰‹å†™ instanceof 
```javascript
function instance_of(L, R){   // L è¡¨ç¤º instanceof å·¦è¾¹ï¼Œ R è¡¨ç¤º instanceof å³è¾¹
  if(typeof L !== 'object') return false; // å·¦è¾¹ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ç›´æ¥è¿”å› false

  let O = R.prototype;
  // åˆ¤æ–­ O æ˜¯å¦æ˜¯å¯¹è±¡ï¼Œä¸æ˜¯å°±æŠ›å‡ºä¸€ä¸ª TypeError çš„é”™è¯¯
  if(typeof O !== 'object') throw Error('TypeError');
  L = L.__proto__;
  while(true){
    if(L === null) return false;
    if(O === L) return true;

    L = L.__proto__;
  } 
}
```

5. instanceof çš„å±€é™æ€§
  - ä¸èƒ½åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªèƒ½åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»
  - å¯¹äº $\color{#6CF}{String}$ $\color{#6CF}{instanceof}$ $\color{#6CF}{String}$ ä»¥åŠ  $\color{#6CF}{Number}$ $\color{#6CF}{instanceof}$ $\color{#6CF}{Number}$ ç­‰æ¥è¯´éƒ½ä¼šè¿”å› false
```javascript
function Foo(name) {
  this.name = name;
}
var a = 1;
a instanceof Number;       // false
String instanceof String;  // false
Number instanceof Number;  // false
Foo instanceof Foo;  // false
```
  - åˆ†æï¼š
    - é¦–å…ˆ ECMA è§„èŒƒä¸­æŒ‡å‡º instanceof æ˜¯æ¥åˆ¤æ–­ object ç±»å‹çš„ï¼Œå¦‚æœä¸æ˜¯å°±è¿”å› false
    - ç„¶åå°±æ˜¯ Number å’Œ String éƒ½æ˜¯æ„é€ å‡½æ•°ï¼ŒåŸå‹é“¾ä¸Šæ˜¯ç”± Function å®ä¾‹åŒ–è€Œæ¥çš„ã€‚
    - æˆ‘ä»¬é€šè¿‡åˆ†æ Foo å°±èƒ½å¾—å‡ºåŸå› ï¼š
```javascript
let O = R.prototype = Foo.prototype
L = L.__proto__ = Foo.__proto__ = Function.prototype

O !== L // å¾ªç¯
L = L.__proto__ = Function.prototype.__proto__ = Object.prototype

O !== L // å¾ªç¯
L = L.__proto__ = Object.prototype.__proto__ = null

return false
```
--- 
### å››ã€ new å…³é”®å­—
new å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ: [æ‰‹å†™new](newçš„å®ç°.html)
1. åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•çš„ JavaScript å¯¹è±¡ï¼ˆå³ {}ï¼‰ï¼›
2. é“¾æ¥è¯¥å¯¹è±¡ï¼ˆè®¾ç½®è¯¥å¯¹è±¡çš„ constructorï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼›
3. å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º this çš„ä¸Šä¸‹æ–‡ï¼›
4. å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› this
  
ä¸€ä¸ªğŸŒ°ï¼š
å½“ new Foo(...) æ‰§è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ï¼š
1. ä¸€ä¸ªç»§æ‰¿è‡ª Foo.prototype çš„å¯¹è±¡è¢«åˆ›å»ºã€‚
2. ä½¿ç”¨æŒ‡å®šçš„å‚æ•°è°ƒç”¨æ„é€ å‡½æ•° Fooï¼Œå¹¶å°† this ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚new Foo ç­‰ä»·äº new Foo()ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŒ‡å®šå‚æ•°åˆ—è¡¨ï¼Œæ„é€ å‡½æ•° Foo ä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨çš„æƒ…å†µã€‚
3. ç”±æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡å°±æ˜¯ new çš„ç»“æœã€‚å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰æ˜¾ç¤ºçš„è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä½¿ç”¨æ­¥éª¤1ä¸­åˆ›å»ºçš„å¯¹è±¡ã€‚ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°ä¸è¿”å›å€¼ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸»åŠ¨è¿”å›å¯¹è±¡ï¼Œæ¥è¦†ç›–æ­£å¸¸çš„å¯¹è±¡åˆ›å»ºæ­¥éª¤ï¼‰ã€‚